<!DOCTYPE html>

<html lang="en">

<head>

<meta http-equiv="Content-Type" content="text/html; charset=utf-8">

<meta name="description" content="TechWave">
<meta name="author" content="Frenify">

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

<title>AItheway</title>


<script>
	if (!localStorage.frenify_skin) {
		localStorage.frenify_skin = 'dark';
	}
	if (!localStorage.frenify_panel) {
		localStorage.frenify_panel = '';
	}
	document.documentElement.setAttribute("data-neltar-skin", localStorage.frenify_skin);
	if(localStorage.frenify_panel !== ''){
		document.documentElement.classList.add(localStorage.frenify_panel);
	}

</script>

    <!-- Bootstrap CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <!-- TwentyTwenty CSS -->
<link rel="stylesheet" href="{{ url_for('static', filename='/dst/css/twentytwenty.css') }}" type="text/css" />

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
<link href="https://fonts.googleapis.com/css2?family=Heebo:wght@100;200;300;400;500;600;700;800;900&family=Work+Sans:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

<link type="text/css" rel="stylesheet" href="{{ url_for('static', filename='assets/css/plugins.css') }}">
<link type="text/css" rel="stylesheet" href="{{ url_for('static', filename='assets/css/style.css') }}">

<link type="text/css" rel="stylesheet" href="{{ url_for('static', filename='assets/css/image-generation-fixes.css') }}">
<link type="text/css" rel="stylesheet" href="{{ url_for('static', filename='assets/css/right-sidebar-tags.css') }}">
<link type="text/css" rel="stylesheet" href="{{ url_for('static', filename='assets/css/premium-features.css') }}">
<link type="text/css" rel="stylesheet" href="{{ url_for('static', filename='assets/css/library.css') }}">
<link type="text/css" rel="stylesheet" href="{{ url_for('static', filename='assets/css/left-nav-bar.css') }}">

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="{{ url_for('static', filename='js/script.js') }}"></script>

<style>

</style>

</head>

<body>


<div class="neltar_fn_fixedsub">
	<ul></ul>
</div>


<div class="neltar_fn_wrapper">
	<div class="neltar_fn_wrap">


		<header class="neltar_fn_header">

			<div class="header__left">
				<div class="fn__token_info">
					<span class="token_summary">
						<span class="count">{{ tokens_remaining if tokens_remaining is defined else '--' }}</span>
						<span class="text">Tokens<br>Remain</span>
					</span>
					<a href="pricing.html" class="token_upgrade neltar_fn_button"><span>Upgrade</span></a>
					<div class="token__popup">
						Resets in <span>--</span><br>
						Daily limit is <span>--</span>
					</div>
				</div>
			</div>

			<div class="header__right">
				<div class="fn__nav_bar">



					<div class="bar__item bar__item_notification has_notification">
						<a href="#" class="item_opener fn__tooltip" title="Notifications">
							<img src="{{ url_for('static', filename='assets/svg/bell.svg') }}" alt="" class="fn__svg">
						</a>
						<div class="item_popup" data-position="right">
							<div class="ntfc_header">
								<h2 class="ntfc_title">Notifications</h2>
								<a href="notifications.html">View All</a>
							</div>
							<div class="ntfc_list">
								<ul>
									<li>
										<p><a href="notification-single.html">Test Notifications</a></p>
										<span>34 Min Ago</span>
									</li>

								</ul>
							</div>
						</div>
					</div>

					<div class="bar__item bar__item_fullscreen">
						<a href="#" class="item_opener fn__tooltip" title="Full Screen">
							<img src="{{ url_for('static', filename='assets/svg/fullscreen.svg') }}" alt="" class="fn__svg f_screen">
							<img src="{{ url_for('static', filename='assets/svg/smallscreen.svg') }}" alt="" class="fn__svg s_screen">
						</a>
					</div>

					<div class="bar__item bar__item_language">
						<a href="#" class="item_opener fn__tooltip" title="Language">
							<img src="{{ url_for('static', filename='assets/svg/language.svg') }}" alt="" class="fn__svg">
						</a>
						<div class="item_popup" data-position="right">
							<ul>
								<li>
									<span class="active">English</span>
								</li>
								<li>
									<a href="#">Spanish</a>
								</li>
								<li>
									<a href="#">French</a>
								</li>
							</ul>
						</div>
					</div>

					<div class="bar__item bar__item_skin">
						<a href="#" class="item_opener fn__tooltip" title="Dark/Light">
							<img src="{{ url_for('static', filename='assets/svg/sun.svg') }}" alt="" class="fn__svg light_mode">
							<img src="{{ url_for('static', filename='assets/svg/moon.svg') }}" alt="" class="fn__svg dark_mode">
						</a>
					</div>

					<div class="bar__item bar__item_user">
						<a href="#" class="user_opener fn__tooltip" title="User Profile">
							<img src="{{ url_for('static', filename='assets/img/user/user.jpg') }}" alt="">
						</a>
						<div class="item_popup" data-position="right">
							<div class="user_profile">
								<div class="user_img">
									<img src="{{ url_for('static', filename='assets/img/user/user.jpg') }}" alt="">
								</div>
								<div class="user_info">
									<h2 class="user_name">Caden Smith<span>Free</span></h2>
									<p><a href="mailto:contact@neltar.co" class="user_email">contact@neltar.co</a></p>
								</div>
							</div>
							<div class="user_nav">
								<ul>
									<li>
										<a href="user-profile.html">
											<span class="icon"><img src="{{ url_for('static', filename='assets/svg/person.svg') }}" alt="" class="fn__svg"></span>
											<span class="text">Profile</span>
										</a>
									</li>
									<li>
										<a href="user-settings.html">
											<span class="icon"><img src="{{ url_for('static', filename='assets/svg/setting.svg') }}" alt="" class="fn__svg"></span>
											<span class="text">Settings</span>
										</a>
									</li>
									<li>
										<a href="user-billing.html">
											<span class="icon"><img src="{{ url_for('static', filename='assets/svg/billing.svg') }}" alt="" class="fn__svg"></span>
											<span class="text">Billing</span>
										</a>
									</li>
									<li>
										<a href="sign-in.html">
											<span class="icon"><img src="{{ url_for('static', filename='assets/svg/logout.svg') }}" alt="" class="fn__svg"></span>
											<span class="text">Log Out</span>
										</a>
									</li>
								</ul>
							</div>
						</div>
					</div>


				</div>
			</div>

		</header>

		<div class="neltar_fn_leftpanel">
            <div class="logo">
        <a href="{{ url_for('index') }}">
            <img src="{{ url_for('static', filename='assets/img/logo/logo_desktop.svg') }}" alt="Logo" class="desktop_logo">
            <img src="{{ url_for('static', filename='assets/img/logo-mobile.png') }}" alt="Logo" class="mobile_logo">
        </a>
    </div>

    <!-- Navigation principale -->
    <div class="navigation">
        <ul class="nav_list main_nav">
            <!-- Section Accueil et Bibliothèque -->
            <li class="nav_group primary_group">
                <a href="{{ url_for('index') }}" class="nav_item {% if request.endpoint == 'index' %}active{% endif %}">
                    <span class="icon">
                        <img src="{{ url_for('static', filename='assets/svg/home.svg') }}" alt="Home" class="fn__svg">
                    </span>
                    <span class="text">Accueil</span>
                </a>
                <a href="{{ url_for('library') }}" class="nav_item {% if request.endpoint == 'library_view' %}active{% endif %}">
                    <span class="icon">
                        <img src="{{ url_for('static', filename='assets/svg/library.svg') }}" alt="Library" class="fn__svg">
                    </span>
                    <span class="text">Bibliothèque</span>
                </a>
            </li>

            <!-- Séparateur -->
            <li class="nav_divider">
                <span>Outils de création</span>
            </li>

            <!-- Section Outils (avec dropdown optionnel) -->
            <li class="nav_group tools_group">
                <!-- Option 1: Liste simple -->
                <a href="{{ url_for('generate_image') }}" class="nav_item {% if request.endpoint == 'generate_image' %}active{% endif %}">
                    <span class="icon">
                        <img src="{{ url_for('static', filename='assets/svg/image.svg') }}" alt="Generate Image" class="fn__svg">
                    </span>
                    <span class="text">Générer une image</span>
                </a>
                <a href="{{ url_for('upload_enhance') }}" class="nav_item {% if request.endpoint == 'upload_enhance' %}active{% endif %}">
                    <span class="icon">
                        <img src="{{ url_for('static', filename='assets/svg/upscale.svg') }}" alt="Enhance Image" class="fn__svg">
                    </span>
                    <span class="text">Améliorer une image</span>
                </a>
                <a href="{{ url_for('generate_audio') }}" class="nav_item {% if request.endpoint == 'generate_audio' %}active{% endif %}">
                    <span class="icon">
                        <img src="{{ url_for('static', filename='assets/svg/volume.svg') }}" alt="Generate Audio" class="fn__svg">
                    </span>
                    <span class="text">Générer de l'audio</span>
                </a>
                <a href="{{ url_for('generate_video') }}" class="nav_item {% if request.endpoint == 'generate_video' %}active{% endif %}">
                    <span class="icon">
                        <img src="{{ url_for('static', filename='assets/svg/film.svg') }}" alt="Generate Video" class="fn__svg">
                    </span>
                    <span class="text">Générer une vidéo</span>
                </a>
                </li>

            <!-- Séparateur -->
            <li class="nav_divider">
                <span>Communauté</span>
            </li>

            <!-- Section Communauté -->
            <li class="nav_group community_group">
                <a href="{{ url_for('get_gallery') }}" class="nav_item {% if request.endpoint == 'get_gallery' %}active{% endif %}">
                    <span class="icon">
                        <img src="{{ url_for('static', filename='assets/svg/gallery.svg') }}" alt="Gallery" class="fn__svg">
                    </span>
                    <span class="text">Galerie communautaire</span>
                </a>
                <!-- Autres fonctionnalités communautaires à venir -->
                <!--
                <a href="{{ url_for('community_challenges') }}" class="nav_item {% if request.endpoint == 'community_challenges' %}active{% endif %}">
                    <span class="icon">
                        <img src="{{ url_for('static', filename='assets/svg/challenge.svg') }}" alt="Challenges" class="fn__svg">
                    </span>
                    <span class="text">Défis créatifs</span>
                </a>
                -->
            </li>
        </ul>
    </div>

    <!-- Informations utilisateur et tokens -->
    <div class="user_info">
        <div class="token_info">
            <div class="token_count">
                <span class="number">{{ tokens_remaining|default(0) }}</span>
                <span class="label">Tokens</span>
            </div>
            <a href="#" class="get_tokens">Obtenir plus</a>
        </div>
        <div class="user_profile">
            <!-- Informations utilisateur -->
        </div>
    </div>
</div>


 		</div>

		<div class="neltar_fn_content">

        <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Sidebar toggle functionality
              const desktopCloser = document.querySelector('.desktop_closer');
              const mobileCloser = document.querySelector('.mobile_closer');

              if (desktopCloser) {
                desktopCloser.addEventListener('click', function(e) {
                  e.preventDefault();
                  document.documentElement.classList.toggle('panel-opened');
                  localStorage.frenify_panel = document.documentElement.classList.contains('panel-opened') ? 'panel-opened' : '';
                });
              }

              if (mobileCloser) {
                mobileCloser.addEventListener('click', function(e) {
                  e.preventDefault();
                  document.body.classList.toggle('mobile-panel-opened');
                });
              }

              // Add class to wrapper to activate sidebar
              document.querySelector('.neltar_fn_wrapper').classList.add('fn__has_sidebar');

            // Initialiser le thème et le panneau
            if (!localStorage.frenify_skin) {
                localStorage.frenify_skin = 'dark';
            }
            if (!localStorage.frenify_panel) {
                localStorage.frenify_panel = '';
            }
            document.documentElement.setAttribute("data-neltar-skin", localStorage.frenify_skin);
            if (localStorage.frenify_panel !== '') {
                document.documentElement.classList.add(localStorage.frenify_panel);
            }

            // Fonction pour récupérer et actualiser le nombre de tokens
            function updateTokenDisplay() {
                // Récupérer le token JWT depuis la variable globale
                const jwtToken = window.jwtToken;

                if (!jwtToken) {
                    console.log("Aucun JWT token trouvé");
                    return;
                }

                // Récupérer le token d'URL comme fallback si besoin
                const urlParams = new URLSearchParams(window.location.search);
                const urlToken = urlParams.get('token');
                const tokenToUse = jwtToken || urlToken;

                if (!tokenToUse) {
                    console.log("Aucun token trouvé");
                    return;
                }

                // Appeler l'API pour obtenir les tokens
                fetch('/api/user/tokens?token=' + encodeURIComponent(tokenToUse))
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            // Mettre à jour l'affichage des tokens
                            const tokenCount = document.querySelector('.fn__token_info .count');
                            if (tokenCount) {
                                tokenCount.textContent = data.data.tokens_remaining;
                            }

                            // Mettre à jour le popup de info tokens (rechargement)
                            const tokenPopup = document.querySelector('.token__popup');
                            if (tokenPopup && data.data.next_refill) {
                                const nextRefill = new Date(data.data.next_refill);
                                const now = new Date();

                                // Calculer le temps restant
                                const diffInHours = Math.round((nextRefill - now) / (1000 * 60 * 60));

                                tokenPopup.innerHTML = `
                                    Resets in <span>${diffInHours} hours.</span><br>
                                    Daily limit is <span>${getTokenLimit(data.data.subscription_level)} tokens</span>
                                `;
                            }
                        } else {
                            console.log("Erreur lors de la récupération des tokens:", data.error);
                        }
                    })
                    .catch(error => {
                        console.error('Error fetching token data:', error);
                    });
            }

            // Fonction pour déterminer la limite de tokens selon l'abonnement
            function getTokenLimit(subscriptionLevel) {
                const limits = {
                    "basic": 150,
                    "premium": 500,
                    "pro": 1500
                };

                return limits[subscriptionLevel] || 150;
            }

            // Propager le token dans les liens et formulaires
            function propagateToken() {
                // Récupérer le token de l'URL actuelle
                const urlParams = new URLSearchParams(window.location.search);
                const token = urlParams.get('token');

                if (token) {
                    // Modifier TOUS les liens de navigation
                    document.querySelectorAll('a').forEach(link => {
                        // Ne pas modifier les liens externes
                        if (link.href.startsWith(window.location.origin)) {
                            const url = new URL(link.href);
                            // Préserver les autres paramètres d'URL existants
                            url.searchParams.set('token', token);
                            link.href = url.toString();
                        }
                    });

                    // Modifier tous les formulaires pour inclure le token
                    document.querySelectorAll('form').forEach(form => {
                        // Vérifier si un champ token existe déjà
                        const existingInput = form.querySelector('input[name="token"]');
                        if (!existingInput) {
                            const input = document.createElement('input');
                            input.type = 'hidden';
                            input.name = 'token';
                            input.value = token;
                            form.appendChild(input);
                        }
                    });
                }
            }

            // Ajouter des événements personnalisés pour la génération d'images
            function setupImageEvents() {
                // Pour la génération d'image DALL-E
                const generateForm = document.getElementById('image-generation-form');
                if (generateForm) {
                    generateForm.addEventListener('submit', function() {
                        // Le formulaire va se soumettre normalement, mais on crée un événement
                        // que updateTokenDisplay écoutera après la réponse
                        setTimeout(function() {
                            const event = new CustomEvent('imageGenerated');
                            document.dispatchEvent(event);
                        }, 1000);
                    });
                }

                // Pour l'amélioration d'image
                const enhanceForm = document.getElementById('image-enhance-form');
                if (enhanceForm) {
                    enhanceForm.addEventListener('submit', function() {
                        setTimeout(function() {
                            const event = new CustomEvent('imageEnhanced');
                            document.dispatchEvent(event);
                        }, 1000);
                    });
                }
            }

            // Exécuter toutes nos fonctions d'initialisation
            updateTokenDisplay();
            propagateToken();
            setupImageEvents();

            // Actualiser les tokens toutes les minutes
            setInterval(updateTokenDisplay, 60000);

            // Écouter les événements de génération/amélioration d'image
            document.addEventListener('imageGenerated', updateTokenDisplay);
            document.addEventListener('imageEnhanced', updateTokenDisplay);
        });
    </script>

        {% block content %}{% endblock %}

    <footer class="neltar_fn_footer">
        <div class="neltar_fn_footer_content">
            <div class="copyright">
                <p>© 2024 AItheway. Tous droits réservés.</p>
            </div>
            <div class="menu_items">
                <ul>
                    <li><a href="terms.html">Terms of Service</a></li>
                    <li><a href="privacy.html">Privacy Policy</a></li>
                </ul>
            </div>
        </div>
    </footer>

</div>


	</div>
</div>



<script type="text/javascript" src="{{ url_for('static', filename='assets/js/jquery.js') }}"></script>

<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>

<script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

<script src="{{ url_for('static', filename='js/jquery.event.move.js') }}"></script>
<script src="{{ url_for('static', filename='js/jquery.twentytwenty.js') }}"></script>


<script type="text/javascript" src="{{ url_for('static', filename='assets/js/plugins.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='assets/js/init.js') }}"></script>
<script src="{{ url_for('static', filename='js/left-nav-bar.js') }}"></script>

<script src="{{ url_for('static', filename='js/script.js') }}"></script>


</body>
</html>